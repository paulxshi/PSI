<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PMMA Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.js"></script>
  <script src="js/registration.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="icon" href="imgs/PSI.png">
  <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">

  <style>
  :root {
  --primary: #ef8809;
 }

/* HIDE REAL INPUT */
.otp-hidden-input {
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

.otp-box {
  width: 44px;
  height: 52px;
  border-radius: 6px;
  border: 2px solid #c7cbe6;
  background: #f8f9fc;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  font-weight: 600;
  color: #111827;
  transition: all 0.2s ease;
}

/* ACTIVE STATE */
.otp-box.active {
  border-color: #4f4f4f;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
  background: #ffffff;
}

/* FILLED STATE */
.otp-box.filled {
  border-color: #2563eb;
  background: #ffffff;
}

 .form-control:disabled,
 .form-select:disabled {
   background-color: #f8f9fa;
   opacity: 1;
   cursor: not-allowed;
 }

 /* Small auto-generated age field */
#age {
  background-color: #f8f9fa;
  font-weight: 600;
  border-style: dashed;
  border-color: #ced4da;
  cursor: not-allowed;
}

#age::placeholder {
  color: #adb5bd;
}


.btn-send-otp {
  background: linear-gradient(135deg, #ffb347, #ef8809);
  border: none;
  color: #000000;
  font-weight: 600;
  padding: 0.45rem 1.2rem;
  border-radius: 999px;
  font-size: 0.85rem;
  transition: all 0.3s ease;
  box-shadow: 0 6px 14px rgba(239, 136, 9, 0.25);
}

.btn-send-otp:hover {
  background: linear-gradient(135deg, #ef8809, #d97706);
  color: #fff;
  transform: translateY(-1px);
  box-shadow: 0 8px 18px rgba(239, 136, 9, 0.35);
}

.btn-send-otp:active {
  transform: scale(0.97);
}

/* VERIFY OTP BUTTON */
.btn-verify-otp {
  background: linear-gradient(135deg, #ffb347, #ef8809);
  border: none;
  color: #fff;
  font-weight: 600;
  padding: 0.5rem 1.4rem;
  border-radius: 999px;
  transition: all 0.3s ease;
  box-shadow: 0 6px 14px rgba(22, 163, 74, 0.25);
}

.btn-verify-otp:hover {
   background: linear-gradient(135deg, #f0971a, #ef8809);
  transform: translateY(-1px);
  box-shadow: 0 8px 18px rgba(22, 163, 74, 0.35);
}

.btn-verify-otp:active {
  transform: scale(0.97);
}
.verified-badge {
  background: linear-gradient(135deg, #16a34a, #15803d);
  color: #fff;
  padding: 0.45rem 0.75rem;
  font-weight: 600;
  font-size: 0.75rem;
  border-radius: 999px;
  box-shadow: 0 4px 10px rgba(22, 163, 74, 0.35);
  white-space: nowrap;
}

/* OTP INPUT GROUP POLISH */
#otpContainer .form-control {
  border-radius: 999px 0 0 999px;
  font-weight: 600;
}

#otpContainer .btn {
  border-radius: 0 999px 999px 0;
}

/* OTP STATUS TEXT */
#otpStatus {
  display: block;
  font-size: 0.8rem;
  margin-top: 6px;
}
.btn-password-toggle {
  border: 1px solid #dee2e6;
  background-color: #f8f9fa;
  color: #6b7280;
  border-left: 0;
  padding: 0 0.9rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.btn-password-toggle i {
  font-size: 1.05rem;
}

.btn-password-toggle:hover {
  background-color: #eef2ff;
  color: #2563eb;
}

.btn-password-toggle:active {
  background-color: #e0e7ff;
  transform: scale(0.96);
}

.btn-password-toggle:focus {
  box-shadow: none;
}
.input-group .form-control {
  border-right: 0;
}

.input-group .form-control:focus {
  box-shadow: none;
}

 .step {
   cursor: pointer;
 } 
 .stepper {
   gap: 0.5rem;
 }

 .form-control:focus,
 .form-select:focus {
   border-color: #000;
   box-shadow: none;
 }

 .input-group .form-control:focus {
   border-color: #000;
   box-shadow: none;
 }

 .form-control,
 .form-select {
   transition: border-color 0.2s ease;
 }

 .step {
   text-align: center;
   flex: 1;
   color: #6c757d;
   font-weight: 600;
   font-size: 0.8rem;
   transition: all 0.3s ease;
 }

 .step-circle {
   width: 42px;
   height: 42px;
   border-radius: 50%;
   border: 2px solid #ced4da;
   display: flex;
   align-items: center;
   justify-content: center;
   margin: 0 auto 6px;
   font-size: 1.2rem;
   background: #fff;
   transition: all 0.3s ease;
 }

 .step-line {
   flex: 1;
   height: 2px;
   background: #dee2e6;
   margin-top: 20px;
 }

 .step.active {
   color: #000;
 }

 .step.active .step-circle {
   border-color: var(--primary);
   background: var(--primary);
   color: #ffffff;
   box-shadow: 0 6px 18px rgba(247, 222, 34, 0.45);
 }

 .step.completed {
   color: #198754;
 }

 .step.completed .step-circle {
   background: #198754;
   border-color: #198754;
   color: #fff;
 }

 .btn-primary {
   background-color: var(--primary);
   border-color: var(--primary);
   color: #000;
   font-weight: 600;
 }

 .btn-primary:hover {
   background-color:#b56401;
   border-color: #b56401;
   color: #ffffff;
 }

 .overflow-auto::-webkit-scrollbar {
     display: none;
  } 

 .otp-verified-badge {
       background-color: #198754;
       color: white;
       padding: 2px 8px;
       border-radius: 4px;
       font-size: 0.75rem;
       margin-left: 8px;
     }

     .flatpickr-calendar {
       background: white;
       box-shadow: 0 4px 12px rgba(0,0,0,0.15);
 }

    .btn-understand {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      border: none;
      color: #fff;
      font-weight: 600;
      font-size: 0.85rem;
      box-shadow: 0 6px 14px rgba(37, 99, 235, 0.25);
      transition: all 0.25s ease;
    }

    .btn-understand:hover {
      background: linear-gradient(135deg, #1d4ed8, #1e40af);
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(37, 99, 235, 0.35);
    }

    .btn-understand:active {
      transform: scale(0.96);
    }
    .permit-input {
      max-width: 260px;
    }
  </style>

 </head>

<body
  class="min-vh-100 d-flex align-items-center justify-content-center"
  style="background: url('imgs/bg.jpg') center center / cover no-repeat fixed;"
 >

<div
  class="position-fixed top-0 start-0 w-100 h-100"
  style="backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); z-index: 0;">
</div>

<div class="container position-relative" style="z-index: 1;">
  <div class="row justify-content-center">
    <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-9">

      <div class="card shadow-lg border-0 rounded-4 bg-white bg-opacity-75">
        <div class="card-body p-4">

        <div class="d-flex justify-content-center align-items-center mb-4">
          <img src="imgs/PSI.png" class="img-fluid" style="max-width:80px;">
          <div class="mx-3" style="width:1px; height:40px; background-color:#8f8f8f;"></div>
          <img src="imgs/PMMA.png" class="img-fluid" style="max-width:80px;">
        </div>


        <!-- MODERN STEPPER CARD -->
        <div class="card border-0 shadow-sm rounded-4 mb-4">
          <div class="card-body px-4 py-3">

            <div class="d-flex justify-content-between align-items-center stepper">

                    <!-- Step 1 -->
                    <div class="step active" id="step-reminders" onclick="goToStep(1)">
                      <div class="step-circle">
                        <i class="bi bi-exclamation-circle"></i>
                      </div>
                      <span>Reminders</span>
                    </div>

                    <div class="step-line"></div>

                    <!-- Step 2 -->
                    <div class="step" id="step-personal-info">
                      <div class="step-circle">
                        <i class="bi bi-person-lines-fill"></i>
                      </div>
                      <span>Information</span>
                    </div>

                    <div class="step-line"></div>

                    <!-- Step 3 -->
                    <div class="step" id="step-exam-schedule">
                      <div class="step-circle">
                        <i class="bi bi-calendar-check"></i>
                      </div>
                      <span>Exam Schedule</span>
                    </div>

                    <div class="step-line"></div>

                    <!-- Step 4 -->
                    <div class="step" id="step-payment">
                      <div class="step-circle">
                        <i class="bi bi-credit-card"></i>
                      </div>
                      <span>Payment</span>
                    </div>

                    <div class="step-line"></div>

                    <!-- Step 5 -->
                    <div class="step" id="step-finish">
                      <div class="step-circle">
                        <i class="bi bi-check-circle"></i>
                      </div>
                      <span>Finish</span>
                    </div>

                  </div>
                </div>
              </div>

            <!-- REMINDERS CARD -->
            <div id="reminderCard" class="card border-0 shadow-sm rounded-4 mb-4">
              <div class="card-body p-4">

                <div class="d-flex align-items-center mb-3">
                  <i class="bi bi-shield-lock-fill text-primary me-2" style="font-size:1.4rem;"></i>
                  <h5 class="mb-0 fw-semibold">Terms and Conditions</h5>
                </div>

                  <div
                    id="termsContainer"
                    class="p-3 rounded-3 mb-4 overflow-auto"
                    style="background:#f8f9fa; line-height:1.7; max-height: 220px;"
                  >
                    <p class="small text-muted">
                      By proceeding with this registration, you acknowledge and agree that all
                      information, statements, and documents you submit through the PSI Examination
                      System are true, accurate, complete, and correct to the
                      best of your knowledge.
                    </p>

                    <p class="small text-muted">
                      The system will collect and process personal information including, but not
                      limited to, your full name, date of birth, age, gender, contact number, email
                      address, school affiliation, test permit number, and other details required
                      for examination registration, identity verification, scheduling, and official
                      record purposes.
                    </p>

                    <p class="small text-muted">
                      In compliance with <strong>Republic Act No. 10173</strong>, otherwise known as
                      the <strong>Data Privacy Act of 2012</strong>, all personal data collected shall
                      be handled with strict confidentiality and shall be processed, stored, and
                      protected using reasonable organizational, physical, and technical security
                      measures. Your information will only be accessed by authorized personnel and
                      will not be disclosed to unauthorized third parties, except as required by
                      law or official regulatory bodies.
                    </p>

                    <p class="small text-muted">
                      By registering, you expressly consent to the collection, use, storage, and
                      processing of your personal data for purposes that include examination
                      administration, exam scheduling, identity validation, result processing,
                      payment verification, account management, and official communications related
                      to the PSI examination.
                    </p>

                    <p class="small text-muted">
                      The system includes an online examination scheduling feature. Once an
                      examination schedule has been selected and confirmed, it shall be considered
                      final. Requests for changes, rescheduling, or cancellations may be subject to
                      approval and applicable policies set by the administering authority.
                    </p>

                    <p class="small text-muted">
                      Examination fees collected through this system are used to cover
                      administrative, operational, and examination-related costs. Please be
                      advised that <strong>all payments made are strictly non-refundable</strong>,
                      regardless of whether the applicant fails to attend the examination,
                      withdraws the application, provides incorrect information, or fails to meet
                      eligibility requirements.
                    </p>

                    <p class="small text-muted">
                      No refunds shall be issued under any circumstances once payment has been
                      successfully processed, including but not limited to examination
                      disqualification, schedule conflicts, technical issues on the applicant’s
                      end, or failure to complete subsequent steps in the registration process.
                    </p>

                    <p class="small text-muted">
                      Any misrepresentation, omission, falsification of information, or submission
                      of fraudulent documents may result in the denial, cancellation, or revocation
                      of your application, disqualification from the examination, and possible
                      prohibition from future PSI examinations, without prior notice and without
                      refund.
                    </p>

                    <p class="small text-muted mb-0">
                      By continuing with this registration, you confirm that you have read,
                      understood, and voluntarily agreed to all the terms and conditions stated
                      above, including the data privacy provisions and the no-refund policy.
                    </p>

                  </div>

                  <div class="form-check mb-4 d-none" id="termsCheckboxWrapper">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="agreeTerms"
                    >
                    <label class="form-check-label small" for="agreeTerms">
                      I have read and agree to the Terms and Conditions
                    </label>
                  </div>



                <div class="d-flex justify-content-end">
                  <button
                    id="reminderProceedBtn"
                    class="btn btn-primary px-4 rounded-pill"
                    onclick="goToPersonalInfo()"
                    disabled
                  >
                    Proceed
                    <i class="bi bi-arrow-right-short"></i>
                  </button>

                </div>
              </div>
            </div>




          <!-- REGISTER FORM -->
          <form id="registrationForm" class="overflow-auto" style="max-height: 65vh;" method="POST" novalidate>
            <div id="personalInfoCard" class="card border-0 shadow-sm rounded-4 mb-4 d-none">
              <div class="card-body p-4">

                <h6 class="fw-semibold mb-4">
                  <i class="bi bi-person-lines-fill me-2 text-primary"></i>
                  Personal Information
                </h6>

                <!-- STEP 1: TEST PERMIT VERIFICATION (ALWAYS FIRST) -->
                <div class="row g-3 mb-4 pb-4 border-bottom">
                  <div class="col-12">
                    <label class="form-label fw-semibold">
                      Test Permit Number <span class="text-danger">*</span>
                    </label>
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control permit-input"
                        name="test_permit_no"
                        id="testPermitNo"
                        required
                        placeholder="Enter Test Permit Number"
                      >
                      <button
                        type="button"
                        id="verifyTestPermitBtn"
                        class="btn btn-primary"
                      >
                        <i class="bi bi-check-circle me-1"></i>
                        Verify
                      </button>
                    </div>
                    <small id="testPermitStatus" class="mb-2 mt-1 small fw-semibold" style="display:none;"></small>
                  </div>
                </div>

                <!-- STEP 2: PERSONAL INFO (DISABLED UNTIL PERMIT VERIFIED) -->
                <!-- ROW 1: LAST / FIRST / MIDDLE -->
                <div class="row g-3 mb-3">
                  <div class="col-md-4">
                    <label class="form-label fw-semibold">Last Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" name="last_name" id="lastName" required disabled>
                  </div>

                  <div class="col-md-4">
                    <label class="form-label fw-semibold">First Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" name="first_name" id="firstName" required disabled>
                  </div>

                  <div class="col-md-4">
                    <label class="form-label fw-semibold">Middle Name</label>
                    <input type="text" class="form-control" name="middle_name" id="middleName" disabled>
                  </div>
                </div>

              <!-- ROW: DATE OF BIRTH / AGE / GENDER -->
                  <div class="row g-3 mb-3 align-items-end">

                    <!-- DATE OF BIRTH -->
                    <div class="col-md-6">
                      <label class="form-label fw-semibold">
                        Date of Birth <span class="text-danger">*</span>
                      </label>
                      <input
                        type="text"
                        class="form-control"
                        name="date_of_birth"
                        id="dateOfBirth"
                        required
                        placeholder="Select date"
                        disabled
                      >
                    </div>

                    <!-- AGE (AUTO-CALCULATED) -->
                    <div class="col-md-2">
                      <label class="form-label fw-semibold text-muted small">
                        Age
                      </label>
                      <input
                        type="text"
                        class="form-control text-center"
                        id="age"
                        name="age"
                        readonly
                        placeholder="—"
                        disabled
                      >
                    </div>

                    <!-- GENDER -->
                    <div class="col-md-4">
                    <label class="form-label">
                      Gender <span class="text-danger">*</span>
                    </label>

                    <select class="form-select" id="gender" name="gender" required disabled>
                      <option value="" selected disabled>Select gender</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                      <option value="Prefer not to say">Prefer not to say</option>
                    </select>

                    <div class="invalid-feedback">
                      Please select your gender.
                    </div>

                    </div>

                  </div>

                  <!-- ROW: CONTACT NUMBER & SCHOOL -->
                  <div class="row g-3 mb-3">
                    <div class="col-md-6">
                      <label class="form-label fw-semibold">
                        Contact Number <span class="text-danger">*</span>
                      </label>
                      <input
                        type="tel"
                        class="form-control"
                        name="contact_number"
                        id="contactNumber"
                        required
                        placeholder="e.g., 09123456789"
                        disabled
                      >
                    </div>

                    <div class="col-md-6">
                      <label class="form-label fw-semibold">School <span class="text-danger">*</span></label>
                      <input
                        type="text"
                        class="form-control"
                        name="school"
                        id="school"
                        required
                        placeholder="Enter School Name"
                        disabled
                      >
                    </div>
                  </div>

                <!-- ROW 4: EMAIL -->
                <div class="row mb-2">
                  <div class="col-12">
                    <label class="form-label fw-semibold">Email Address <span class="text-danger">*</span></label>
                    <div class="input-group">
                      <input type="email" class="form-control" name="email" id="email" required placeholder="user@example.com" disabled>

                        <button
                          type="button"
                          id="sendOtpBtn"
                          class="btn btn-send-otp ms-2"
                        >
                          <i class="bi bi-shield-lock me-1"></i>
                          Send OTP
                        </button>

                      <span id="otpVerifiedBadge" class="badge verified-badge ms-2" style="display:none;">
                        <i class="bi bi-shield-check me-1"></i>
                        Verified
                      </span>
                    </div>
                    <small id="otpStatus" class="mb-2 mt-1 small fw-semibold" style="display:none;"></small>
                  </div>
                </div>

                <!-- OTP INPUT -->
<!-- OTP INPUT (BOX STYLE – SAME FUNCTION) -->
<div id="otpContainer" class="mb-4" style="display:none;">
  <label class="form-label fw-semibold mb-3">
    OTP Code <span class="text-danger">*</span>
  </label>

  <!-- Hidden REAL input (your logic uses this) -->
  <input
    type="text"
    id="otpInput"
    maxlength="6"
    autocomplete="one-time-code"
    inputmode="numeric"
    class="otp-hidden-input"
  />

  <!-- Visual OTP boxes -->
  <div class="d-flex justify-content-center gap-2 mb-3" id="otpBoxes">
    <div class="otp-box"></div>
    <div class="otp-box"></div>
    <div class="otp-box"></div>
    <div class="otp-box"></div>
    <div class="otp-box"></div>
    <div class="otp-box"></div>
  </div>

  <div class="text-center">
    <button
      type="button"
      id="verifyOtpBtn"
      class="btn btn-verify-otp px-4 rounded-pill"
    >
      Verify & Continue
    </button>
  </div>

  <small class="text-muted d-block text-center mt-2">
    Enter the 6-digit code sent to your email
  </small>
</div>


                
                <!-- RESEND OTP -->
                <div class="mb-3">
                  <small
                    id="resendOtpBtn"
                    class="text-primary fw-semibold"
                    style="cursor:pointer; display:none;"
                  >
                    Resend OTP
                  </small>
                </div>
                <!-- PASSWORD SECTION -->
                <div id="passwordSection" style="display:none;">
                  <div class="row g-3 mb-3">
                    <div class="col-md-6">
                      <label class="form-label">
                        Password <span class="text-danger">*</span>
                      </label>

                      <div class="input-group">
                        <input
                          type="password"
                          class="form-control"
                          id="password"
                          placeholder="At least 8 characters"
                          required
                          disabled
                        >
                        <button
                          class="btn btn-password-toggle"
                          type="button"
                          id="togglePassword"
                          aria-label="Toggle password visibility"
                        >
                          <i class="bi bi-eye"></i>
                        </button>

                      </div>

                      <div class="small text-muted mt-1">
                        Must contain uppercase, lowercase, and number
                      </div>

                    </div>

                    <div class="col-md-6">
                      <label class="form-label">
            Confirm Password <span class="text-danger">*</span>
          </label>

          <div class="input-group">
            <input
              type="password"
              class="form-control"
              id="confirmPassword"
              placeholder="Re-enter password"
              required
            >
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="toggleConfirmPassword"
              aria-label="Toggle confirm password visibility"
            >
              <i class="bi bi-eye"></i>
            </button>
          </div>

                    </div>
                  </div>

                  <div class="d-flex justify-content-end mb-3">
                    <button
                      type="button"
                      class="btn btn-primary px-4 rounded-pill"
                      id="registerBtn"
                      disabled
                    >
                      Proceed to Examination Schedule 
                      <i class="bi bi-arrow-right-short"></i>
                    </button>

                  </div>
                </div>
              </div>
          </div>


                      <!-- REGISTRATION COMPLETE -->
                      <div id="registrationComplete" class="card border-0 shadow-sm rounded-4 mb-4 d-none">
                        <div class="card-body p-4 text-center">

                          <div class="mb-4">
                            <i class="bi bi-check-circle text-success" style="font-size: 3rem;"></i>
                          </div>

                          <h5 class="fw-semibold mb-2">Registration Complete!</h5>

                          <p class="text-muted mb-4">
                            Your registration has been successfully submitted. 
                            You will receive a confirmation email shortly with your account details.
                          </p>

                          <div class="alert alert-info small mb-4">
                            <strong>Next Steps:</strong><br>
                            1. Check your email for confirmation<br>
                            2. Proceed to login with your credentials<br>
                            3. Download your test permit once approved
                          </div>

                          <a href="login.html" class="btn btn-primary px-4 rounded-pill">
                            Login to Your Account
                            <i class="bi bi-arrow-right ms-1"></i>
                          </a>

                        </div>
                      </div>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>
<script>
  function goToPersonalInfo() {
    document.getElementById('reminderCard').classList.add('d-none');
    document.getElementById('personalInfoCard').classList.remove('d-none');

    document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
    document.querySelectorAll('.step')[1].classList.add('active');
  }

  function goToStep(step) {
    const reminderCard = document.getElementById('reminderCard');
    const personalInfoCard = document.getElementById('personalInfoCard');

    steps.forEach(s => s.classList.remove('active', 'completed'));

    if (step === 1) {
      reminderCard.classList.remove('d-none');
      personalInfoCard.classList.add('d-none');
      paymentCard.classList.add('d-none');
      registrationComplete.classList.add('d-none');
      steps[0].classList.add('active');
    } else if (step === 2) {
      reminderCard.classList.add('d-none');
      personalInfoCard.classList.remove('d-none');
      paymentCard.classList.add('d-none');
      registrationComplete.classList.add('d-none');
      steps[1].classList.add('active');
    } else if (step === 3) {
      reminderCard.classList.add('d-none');
      personalInfoCard.classList.add('d-none');
      paymentCard.classList.add('d-none');
      registrationComplete.classList.add('d-none');
      steps[2].classList.add('active');
    } else if (step === 4) {
      reminderCard.classList.add('d-none');
      personalInfoCard.classList.add('d-none');
      paymentCard.classList.remove('d-none');
      registrationComplete.classList.add('d-none');
      steps[3].classList.add('active');
    } else if (step === 5) {
      reminderCard.classList.add('d-none');
      personalInfoCard.classList.add('d-none');
      paymentCard.classList.add('d-none');
      registrationComplete.classList.remove('d-none');  
      steps[4].classList.add('active');
    }

    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function goToExamSchedule() {
    console.log('goToExamSchedule() called');
    const personalInfoCard = document.getElementById('personalInfoCard');
    
    console.log('personalInfoCard exists:', !!personalInfoCard);
    
    if (personalInfoCard) {
      personalInfoCard.classList.add('d-none');
      console.log('Hidden personal info card');
    }

    const steps = document.querySelectorAll('.step');
    console.log('Found steps:', steps.length);
    
    steps.forEach(step => step.classList.remove('active', 'completed'));

    if (steps[0]) steps[0].classList.add('completed'); // Reminders
    if (steps[1]) steps[1].classList.add('completed'); // Personal Info
    if (steps[2]) steps[2].classList.add('active');

    window.scrollTo({ top: 0, behavior: 'smooth' });
    console.log('Scrolled to top');
  }
</script>

<script>
  const requiredFields = [
    'lastName',
    'firstName',
    'dateOfBirth',
    'contactNumber',
    'testPermitNo',
    'school',
    'email',
    'password',
    'confirmPassword'
  ];

  const registerBtn = document.getElementById('registerBtn');

  function checkPersonalInfoCompletion() {
    let isComplete = true;

    requiredFields.forEach(id => {
      const field = document.getElementById(id);
      if (!field || field.value.trim() === '') {
        isComplete = false;
      }
    });

    registerBtn.disabled = !isComplete;
  }

  requiredFields.forEach(id => {
    const field = document.getElementById(id);
    if (field) {
      field.addEventListener('input', checkPersonalInfoCompletion);
    }
  });

    // Submit registration data when clicking "Proceed to Examination Schedule"
  registerBtn.addEventListener('click', () => {
    submitRegistration();
  });

  // Submit registration function
  function submitRegistration() {
    const formData = new FormData();
    
    // Add all form fields
    formData.append('test_permit', document.getElementById('testPermitNo').value.trim());
    formData.append('last_name', document.getElementById('lastName').value.trim());
    formData.append('first_name', document.getElementById('firstName').value.trim());
    formData.append('middle_name', document.getElementById('middleName').value.trim());
    formData.append('email', document.getElementById('email').value.trim());
    formData.append('date_of_birth', document.getElementById('dateOfBirth').value.trim());
    formData.append('contact_number', document.getElementById('contactNumber').value.trim());
    formData.append('gender', document.getElementById('gender').value);
    formData.append('school', document.getElementById('school').value.trim());
    formData.append('address', document.getElementById('address')?.value.trim() || '');
    formData.append('nationality', document.getElementById('nationality')?.value.trim() || '');
    formData.append('password', document.getElementById('password').value);
    formData.append('confirm_password', document.getElementById('confirmPassword').value);

    // Disable button and show loading state
    registerBtn.disabled = true;
    registerBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Saving...';

    fetch('php/register.php', {
      method: 'POST',
      body: formData,
      credentials: 'same-origin'
    })
    .then(response => response.json())
    .then(data => {
      console.log('Registration Response:', data);
      
      if (data.success) {
        // Show success modal
        const successModal = new bootstrap.Modal(document.getElementById('registrationSuccessModal'));
        successModal.show();
        
        // Redirect to exam schedule after short delay
        setTimeout(() => {
          window.location.href = 'examsched.html';
        }, 1500);
      } else {
        // Show error modal
        document.getElementById('registrationErrorMessage').textContent = data.message || 'Registration failed. Please try again.';
        const errorModal = new bootstrap.Modal(document.getElementById('registrationErrorModal'));
        errorModal.show();
        
        registerBtn.disabled = false;
        registerBtn.innerHTML = 'Proceed to Examination Schedule <i class="bi bi-arrow-right-short"></i>';
      }
    })
    .catch(error => {
      console.error('Registration Error:', error);
      
      // Show error modal
      document.getElementById('registrationErrorMessage').textContent = 'Network error. Please try again.';
      const errorModal = new bootstrap.Modal(document.getElementById('registrationErrorModal'));
      errorModal.show();
      
      registerBtn.disabled = false;
      registerBtn.innerHTML = 'Proceed to Examination Schedule <i class="bi bi-arrow-right-short"></i>';
    });
  }

</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const agreeTermsCheckbox = document.getElementById('agreeTerms');
    const reminderProceedBtn = document.getElementById('reminderProceedBtn');
    const understandBtn = document.getElementById('understandBtn');

    if (!understandBtn) {
      console.error('Understand button not found');
      return;
    }

    // When user clicks "I Understand"
    understandBtn.addEventListener('click', () => {
      agreeTermsCheckbox.disabled = false; // enable checkbox
      agreeTermsCheckbox.checked = true;   // auto-check checkbox
      reminderProceedBtn.disabled = false; // enable Proceed
    });

    // Safety check (if user manually unchecks)
    agreeTermsCheckbox.addEventListener('change', () => {
      reminderProceedBtn.disabled = !agreeTermsCheckbox.checked;
    });
  });

</script>

<script>
  function setupPasswordToggle(inputId, toggleBtnId) {
    const input = document.getElementById(inputId);
    const btn = document.getElementById(toggleBtnId);
    const icon = btn.querySelector('i');

    btn.addEventListener('click', () => {
      const isPassword = input.type === 'password';
      input.type = isPassword ? 'text' : 'password';
      icon.classList.toggle('bi-eye');
      icon.classList.toggle('bi-eye-slash');
    });
  }

  setupPasswordToggle('password', 'togglePassword');
  setupPasswordToggle('confirmPassword', 'toggleConfirmPassword');
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const termsContainer = document.getElementById('termsContainer');
  const checkboxWrapper = document.getElementById('termsCheckboxWrapper');
  const agreeTerms = document.getElementById('agreeTerms');
  const proceedBtn = document.getElementById('reminderProceedBtn');

  proceedBtn.disabled = true;

  // Detect scroll to bottom
  termsContainer.addEventListener('scroll', () => {
    const isAtBottom =
      termsContainer.scrollTop + termsContainer.clientHeight >=
      termsContainer.scrollHeight - 5;

    if (isAtBottom) {
      checkboxWrapper.classList.remove('d-none');
    }
  });

  // Enable proceed only when checked
  agreeTerms.addEventListener('change', () => {
    proceedBtn.disabled = !agreeTerms.checked;
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const dobInput = document.getElementById('dateOfBirth');
  const ageInput = document.getElementById('age');

  flatpickr(dobInput, {
    dateFormat: "Y-m-d",
    maxDate: "today",
    onChange: function(selectedDates) {
      if (!selectedDates.length) {
        ageInput.value = '';
        return;
      }

      const birthDate = selectedDates[0];
      const today = new Date();

      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();

      if (
        monthDiff < 0 ||
        (monthDiff === 0 && today.getDate() < birthDate.getDate())
      ) {
        age--;
      }

      ageInput.value = age >= 0 ? age : '';
    }
  });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const otpInput = document.getElementById('otpInput');
  const boxes = document.querySelectorAll('.otp-box');

  // Focus hidden input when clicking boxes
  document.getElementById('otpBoxes').addEventListener('click', () => {
    otpInput.focus();
  });

  otpInput.addEventListener('input', () => {
    otpInput.value = otpInput.value.replace(/\D/g, '').slice(0, 6);

    boxes.forEach((box, index) => {
      box.textContent = otpInput.value[index] || '';
      box.classList.toggle('filled', !!otpInput.value[index]);
      box.classList.toggle('active', index === otpInput.value.length);
    });
  });

  otpInput.addEventListener('focus', () => {
    boxes[otpInput.value.length]?.classList.add('active');
  });

  otpInput.addEventListener('blur', () => {
    boxes.forEach(box => box.classList.remove('active'));
  });
});
</script>

<!-- REGISTRATION SUCCESS MODAL -->
<div class="modal fade" id="registrationSuccessModal" tabindex="-1" aria-hidden="true"
     data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4">
      
      <div class="modal-header border-0 justify-content-center pb-2">
        <h5 class="modal-title fw-semibold">Registration Successful</h5>
      </div>
      
      <div class="modal-body px-4 py-4 text-center">
        <div class="rounded-circle bg-success-subtle text-success mx-auto mb-3
                    d-flex align-items-center justify-content-center"
             style="width:64px;height:64px;">
          <i class="bi bi-check-circle fs-1"></i>
        </div>
        
        <p class="mb-0 text-muted">
          Your account has been created! Redirecting to exam schedule selection...
        </p>
        
        <div class="mt-3">
          <div class="spinner-border spinner-border-sm text-success" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</div>

<!-- REGISTRATION ERROR MODAL -->
<div class="modal fade" id="registrationErrorModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4">
      
      <div class="modal-header border-0 justify-content-center pb-2">
        <h5 class="modal-title fw-semibold">Registration Failed</h5>
        <button type="button" class="btn-close position-absolute end-0 me-3" 
                data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      
      <div class="modal-body px-4 py-4 text-center">
        <div class="rounded-circle bg-danger-subtle text-danger mx-auto mb-3
                    d-flex align-items-center justify-content-center"
             style="width:64px;height:64px;">
          <i class="bi bi-x-circle fs-1"></i>
        </div>
        
        <p class="mb-0 text-muted" id="registrationErrorMessage">
          <!-- Error message will be inserted here -->
        </p>
      </div>
      
      <div class="modal-footer border-0 px-4 pb-4 pt-2 justify-content-center">
        <button type="button" class="btn btn-primary rounded-pill px-4" 
                data-bs-dismiss="modal">
          <i class="bi bi-arrow-left me-1"></i> Try Again
        </button>
      </div>
      
    </div>
  </div>
</div>

<!-- INVALID TEST PERMIT MODAL -->
<div class="modal fade" id="invalidTestPermitModal" tabindex="-1" aria-labelledby="invalidTestPermitLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 rounded-4 shadow-lg">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-semibold" id="invalidTestPermitLabel">
          <i class="bi bi-exclamation-circle text-danger me-2"></i>
          Verification Failed
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center py-4">
        <p class="text-danger fw-semibold mb-0">Test Permit is invalid.</p>
        <p class="text-muted small mt-2">Please check that you've entered the correct Test Permit Number and try again.</p>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-primary px-4 rounded-pill" data-bs-dismiss="modal">
          Try Again
        </button>
      </div>
    </div>
  </div>
</div>



</body>
</html>
