<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PMMA Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="icon" href="imgs/PSI.png">

  <style>
    .overflow-auto::-webkit-scrollbar {
      display: none;
    }
  </style>
</head>

<body
  class="min-vh-100 d-flex align-items-center justify-content-center"
  style="background: url('imgs/bg.jpg') center center / cover no-repeat fixed;"
>

<div
  class="position-fixed top-0 start-0 w-100 h-100"
  style="backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); z-index: 0;">
</div>

<div class="container position-relative" style="z-index: 1;">
  <div class="row justify-content-center">
    <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-5">

      <div class="card shadow-lg border-0 rounded-4 bg-white bg-opacity-75">
        <div class="card-body p-4">

        <div class="d-flex justify-content-center align-items-center mb-4">
          <img src="imgs/PSI.png" class="img-fluid" style="max-width:80px;">
          <div class="mx-3" style="width:1px; height:40px; background-color:#8f8f8f;"></div>
          <img src="imgs/PMMA.png" class="img-fluid" style="max-width:80px;">
        </div>

          <!-- REGISTER FORM -->
          <form class="overflow-auto" style="max-height: 60vh;" action="register.php" method="POST" novalidate>

            <div class="mb-3">
              <label class="form-label fw-semibold">First Name</label>
              <input type="text" class="form-control" name="first_name" required>
            </div>

            <div class="mb-3">
              <label class="form-label fw-semibold">Middle Name</label>
              <input type="text" class="form-control" name="middle_name">
            </div>

            <div class="mb-3">
              <label class="form-label fw-semibold">Last Name</label>
              <input type="text" class="form-control" name="last_name" required>
            </div>

            <div class="mb-3">
              <label class="form-label fw-semibold">Date of Birth</label>
              <input type="date" class="form-control" name="date_of_birth" required>
            </div>

            <div class="mb-3">
              <label class="form-label fw-semibold">Gender</label>
              <input type="text" class="form-control" name="gender">
            </div>

            <div class="mb-3">
              <label class="form-label fw-semibold">Nationality</label>
              <input type="text" class="form-control" name="nationality">
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-semibold">Contact Number</label>
              <input type="tel" class="form-control" name="contact_number" required>
            </div>

            
              <div class="mb-2">
                <label class="form-label fw-semibold">Email Address</label>
                <input type="email" class="form-control" name="email" id="email" required>
              </div>

                    <!-- SEND OTP -->
                    <div class="mb-3">
                      <small
                        id="sendOtpBtn"
                        class="text-primary fw-semibold"
                        style="cursor:pointer; display:none;"
                      >
                        Send OTP
                      </small>

                      <small
                        id="resendOtpBtn"
                        class="text-muted fw-semibold ms-2"
                        style="cursor:pointer; display:none;"
                      >
                        Resend OTP (05:00)
                      </small>
                    </div>

                    <!-- OTP INPUT -->
                    <div class="mb-3" id="otpContainer" style="display:none;">
                      <label class="form-label fw-semibold">OTP Code</label>
                      <input
                        type="text"
                        class="form-control"
                        name="otp"
                        maxlength="6"
                        placeholder="Enter 6-digit OTP"
                      >
                    </div>

            <div class="mb-3">
              <label class="form-label fw-semibold">Password</label>
              <input type="password" class="form-control" name="password" minlength="8" required>
            </div>

            <div class="mb-4">
              <label class="form-label fw-semibold">Confirm Password</label>
              <input type="password" class="form-control" name="confirm_password" required>
            </div>

            <div class="d-grid mb-3">
              <button type="submit" class="btn btn-dark">
                REGISTER
              </button>
            </div>

            <div class="text-center">
              <span class="text-muted">Already have an account?</span>
              <a href="login.html" class="fw-semibold text-decoration-none ms-1">Login</a>
            </div>
            
          </form>

        </div>
      </div>
    </div>
  </div>
</div>


<script>
  const emailInput = document.getElementById("email");
  const sendOtpBtn = document.getElementById("sendOtpBtn");
  const resendOtpBtn = document.getElementById("resendOtpBtn");
  const otpContainer = document.getElementById("otpContainer");

  let cooldown = 300; // 5 minutes
  let timer = null;
  let isCooldownActive = false;

  emailInput.addEventListener("input", () => {
    if (emailInput.validity.valid) {
      sendOtpBtn.style.display = "inline";
    } else {
      sendOtpBtn.style.display = "none";
    }
  });

  sendOtpBtn.addEventListener("click", () => sendOtp(true));
  resendOtpBtn.addEventListener("click", () => {
    if (!isCooldownActive) sendOtp(false);
  });

  function sendOtp(isFirstSend) {
    if (isCooldownActive) return; // ðŸ”’ HARD BLOCK

    isCooldownActive = true;

    sendOtpBtn.style.display = "none";
    otpContainer.style.display = "block";

    lockResendButton();
    startCooldown();

    fetch("send_otp.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email: emailInput.value })
    });
  }

  function startCooldown() {
    let remaining = cooldown;
    updateText(remaining);

    timer = setInterval(() => {
      remaining--;
      updateText(remaining);

      if (remaining <= 0) {
        clearInterval(timer);
        unlockResendButton();
      }
    }, 1000);
  }

  function lockResendButton() {
    resendOtpBtn.style.display = "inline";
    resendOtpBtn.style.pointerEvents = "none";
    resendOtpBtn.style.cursor = "not-allowed";
    resendOtpBtn.classList.remove("text-primary");
    resendOtpBtn.classList.add("text-muted");
  }

  function unlockResendButton() {
    isCooldownActive = false;
    resendOtpBtn.style.pointerEvents = "auto";
    resendOtpBtn.style.cursor = "pointer";
    resendOtpBtn.textContent = "Resend OTP";
    resendOtpBtn.classList.remove("text-muted");
    resendOtpBtn.classList.add("text-primary");
  }

  function updateText(seconds) {
    const min = String(Math.floor(seconds / 60)).padStart(2, "0");
    const sec = String(seconds % 60).padStart(2, "0");
    resendOtpBtn.textContent = `Resend OTP (${min}:${sec})`;
  }
</script>


</body>
</html>
