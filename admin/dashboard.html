<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="../imgs/PSI.png">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<link rel="stylesheet" href="../css/dashstyle.css">
  <link rel="stylesheet" href="../css/style.css">

	<title>Dashboard</title>
</head>


<style>
@media print {
  body {
    background: #fff !important;
  }

  .table-card {
    box-shadow: none !important;
    border: 1px solid #dee2e6;
  }
}
.btn-close:focus,
.no-focus:focus {
    outline: none;
    box-shadow: none;
}
/* Status box base */
.status {
    font-size: 22px;
    font-weight: 600;
    padding: 15px;
    border-radius: 8px;
}

/* ðŸŸ¢ VALID */
.status.valid {
    color: #1e7e34;
    background-color: #dbffe3;
}

/* ðŸ”´ INVALID */
.status.invalid {
    color: #c82333;
    background-color: #f8d7da;
}

/* ðŸŸ¡ WARNING */
.status.warning {
    color: #a07800;
    background-color: #fff3cd;
}


@media (min-width: 992px) {
  .region-divider {
    border-right: 1px solid #e9ecef;
  }
}
.input-group-text {
  border-right: 0;
}

.input-group .form-control:focus {
  box-shadow: none;
}

.input-group:focus-within {
  box-shadow: 0 0 0 0.15rem rgba(13,110,253,.15);
}

.region-table-row {
  border-radius: 0.5rem;
  transition: 
    background-color 0.2s ease,
    box-shadow 0.2s ease,
    transform 0.15s ease;
}

.region-table-row.selected {
  background-color: #e0ffda !important;
  border: 2px solid #6bff8e;
  box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3) !important;
}

</style>
<body>

	<!-- Sidebar Section -->
    <section id="sidebar">
        <a href="#" class="brand" style="display: flex; align-items: center;">
          <img src="../imgs/PSI.png" alt="RHULogo" class="logo">
          <span class="text">PSI-ADMIN Portal</span>
        </a>
        <ul class="side-menu top">
          <li class="active">
            <a href="dashboard.html">
              <i class="bx bxs-dashboard"></i>
              <span class="text">Dashboard</span>
            </a>
          </li>

          <li>
            <a href="schedule.html">
              <i class="bx bx-calendar-check"></i>
              <span class="text">Create Schedule</span>
            </a>
          </li>

          <li>
            <a href="managesched.html">
              <i class="bx bx-edit"></i>
              <span class="text">Schedule Management</span>
            </a>
          </li>

            <li>
                <a href="masterlist.html">
                    <i class="bx bx-list-ul"></i>
                    <span class="text">Examinee Masterlist</span>
                </a>
            </li>
         
            <li>
                <a href="examinee.html">
                    <i class="bx bx-group"></i>
                    <span class="text">Examinee Management</span>
                </a>
            </li>  
                            <li>
                    <a href="examhistory.html">
                        <i class="bx bx-history"></i>
                        <span class="text">Exam History</span>
                    </a>
                </li> 
                
                <li>
                    <a href="activity_log.html">
                        <i class="bx bx-notepad"></i>
                        <span class="text">Activity Log</span>
                    </a>
                </li>
          
        </ul>
        <ul class="side-menu">
      <li>
          <a href="#" data-bs-toggle="modal" data-bs-target="#logoutModal">
            <i class="bx bxs-log-out-circle"></i>
            <span class="text">Logout</span>
          </a>
    </li>
    </ul>		
  </section>

	<section id="content">


<main>

  <div class="container-fluid mt-3 mb-4">
  <div class="card border-0 shadow-sm rounded-4 p-3">
    <div class="d-flex align-items-center gap-3">
      
      <!-- PSI Logo -->
      <img src="../imgs/PSI.png"
           alt="PSI Logo"
           class="rounded-circle"
           style="width:60px; height:60px; object-fit:cover;">

      <!-- Message -->
      <div>
        <h6 class="mb-1 fw-bold text-uppercase" style="letter-spacing:0.08em;">
          Psy Systems and Innovations, OPC
        </h6>
        <p class="mb-0 text-muted small">
          Examination Registration Management Dashboard providing real-time visibility of
          examinee counts, venue capacity limits, and available examination slots across all regions.
        </p>
      </div>

    </div>
  </div>
</div>

<div class="container-fluid mb-4">
  <div class="row justify-content-start">
    <div class="col-xl-4 col-lg-5 col-md-7 col-sm-10">

      <div class="card border-0 rounded-4 p-4">
        <div class="d-flex align-items-center gap-2 mb-3">
          <i class="bx bx bx-qr text-primary fs-5"></i>
          <h6 class="mb-0 fw-semibold">Manual QR Test</h6>
        </div>

        <div class="input-group input-group-md">

          <span class="input-group-text bg-light">
            <i class="bx bx-qr-scan text-muted"></i>
          </span>

          <input
            type="text"
            id="manualQR"
            class="form-control shadow-none"
            placeholder="Enter QR value"
          >

<button id="scanBtn" class="btn btn-primary px-3">
  Scan
</button>

        </div>

        <small class="text-muted d-block mt-2">
          Manual QR validation through direct entry of the QR code value.

        </small>
      </div>

    </div>
  </div>
</div>

  <div class="container-fluid mt-4">

   <div class="row g-3 justify-content-start region-row-wrapper">
 
  <div class="container-fluid mt-4">
    <div class="card border-0 shadow-sm rounded-4 p-4">
      
         <h6 class="mb-0 fw-semibold">Please Select Schedule For Scanning:</h6> <br>
      <div class="row g-4" id="regionsContainer">
        <!-- JS injects regions as columns -->
      </div>
    </div>
  </div>



 

  </div>
</div>
    <!-- PRINT HEADER -->
    <div class="d-none d-print-block mb-4">

      <div class="row align-items-center text-center">
        
        <!-- Left Logo -->
        <div class="col-2 text-start">
          <img src="../imgs/PSI.png" alt="PSI Logo" class="img-fluid" style="max-height:70px;">
        </div>

        <!-- Center Text -->
        <div class="col-8">
          <div class="fw-bold text-uppercase small">
            Psy Systems and Innovation, OPC
          </div>

          <div class="text-muted small">
            Philippine Merchant Marine Academy<br>
            Examination Registration Report
          </div>

          <div class="fw-bold mt-3 text-uppercase" style="letter-spacing:0.18em;">
            Registered Examinees â€” Manila
          </div>
        </div>

        <!-- Right Logo -->
        <div class="col-2 text-end">
          <img src="../imgs/PMMA.png" alt="PMMA Logo" class="img-fluid" style="max-height:70px;">
        </div>

      </div>

      <hr class="mt-4">
    </div>

    <!-- TABLE SECTION -->
    <div class="container-fluid py-5">
      <div class="container py-4">

      <div class="card table-card border-0 overflow-hidden">

        <div class="px-4 py-3 border-bottom bg-white">
          <div class="d-flex align-items-center">


            
            

            <!-- Title -->
            <h6 class="fw-semibold mb-0">
               Completed Examinees: <span id="completedCount">0</span>
            </h6> <br>

             <h6 class="fw-semibold mb-0">
               <span id="currentDate" class="mb-0 ms-2"> </span>
            </h6>

          </div>
        </div>


<div class="table-responsive">
  <table class="table align-middle mb-0 table-hover">
    <thead class="small text-uppercase text-muted">
      <tr>
        <th>Test Permit</th>
        <th>Name</th>
        <th>Email</th>
        <th>Date of Examination</th>
        <th>Status</th>
      </tr>
    </thead>

    <tbody id="examineeTableBody">
      <!-- Data will be inserted here -->
    </tbody>
  </table>
</div>

<script src="js/dashboard_table.js"></script>

        </div>

      </div>
    </div> 

<!-- QR RESULT MODAL -->
<div class="modal fade" id="qrResultModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <!-- HEADER -->
      <div class="modal-header">
        <h5 class="modal-title">Examinee Verification</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body">

        <!-- âœ… VERIFICATION STATUS -->
        <div id="verificationStatus" class="status valid text-center mb-4">
          âœ” VALID â€“ ALLOWED TO ENTER
        </div>


        <!-- âœ… EXAMINEE INFORMATION -->
        <div class="section mb-4">
          <h6 class="border-bottom pb-2">Examinee Information</h6>
          <div class="row">
            <div class="col-4 fw-bold">Name:</div>
            <div class="col-8" id="name"></div>

            <div class="col-4 fw-bold">Test Permit No:</div>
            <div class="col-8" id="test_permit"></div>
          </div>
        </div>


        <!-- âœ… EXAM DETAILS -->
        <div class="section mb-4">
          <h6 class="border-bottom pb-2">Examination Details</h6>
          <div class="row">
            <div class="col-4 fw-bold">Date:</div>
            <div class="col-8" id="examination_date"></div>

            <div class="col-4 fw-bold">Venue:</div>
            <div class="col-8" id="examination_venue"></div>
          </div>
        </div>


        <!-- âœ… PAYMENT CONFIRMATION -->
        <div class="section mb-2">
          <h6 class="border-bottom pb-2">Payment Confirmation</h6>
          <div class="row">
            <div class="col-4 fw-bold">Transaction No:</div>
            <div class="col-8" id="invoice_no"></div>

            <div class="col-4 fw-bold">Payment Status:</div>
            <div class="col-8" id="status"></div>

            <div class="col-4 fw-bold">Payment Date:</div>
            <div class="col-8" id="payment_date"></div>

            <div class="col-4 fw-bold">Amount:</div>
            <div class="col-8" id="payment_amount"></div>
          </div>
        </div>

      </div>

        <!-- AUTO COMPLETE TIMER -->
        <div id="autoCompleteTimer" class="alert alert-success text-center mb-3" style="display: none;">
          <i class="bx bx-check-circle fs-4 me-2"></i>
          Auto-completing in <span id="timerCount" class="fw-bold">5</span> seconds...
          <button id="cancelAutoComplete" class="btn btn-outline-secondary btn-sm ms-2">Cancel</button>
        </div>

      <!-- FOOTER ACTIONS -->
      <div class="modal-footer">
        <button class="btn btn-danger" id="rejectBtn">REJECT</button>
        <button class="btn btn-success" id="completeBtn">MARK AS COMPLETED</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">SCAN NEXT</button>
      </div>

    </div>
  </div>
</div>


</main>

<div
    class="modal fade"
    id="logoutModal"
    tabindex="-1"
    aria-labelledby="logoutModalLabel"
    aria-hidden="true"
>
    <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content border-0 rounded-4 shadow">

            <!-- Modal Header -->
            <div class="modal-header bg-light border-0 rounded-top-4 px-4 py-3">
                <h5 class="modal-title fw-bold mb-0" id="logoutModalLabel">
                    Confirm Logout
                </h5>
                <button
                    type="button"
                    class="btn-close no-focus"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                ></button>
            </div>

            <!-- Divider -->
            <div class="px-4">
                <hr class="my-0">
            </div>

            <!-- Modal Body -->
            <div class="modal-body px-4 py-4 text-center">
                <i class="bx bx-log-out-circle fs-1 text-muted mb-3"></i>
                <p class="mb-0 text-muted">
                    Are you sure you want to log out of your account?
                </p>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer border-0 px-4 pb-4 pt-2 justify-content-center">
                <button
                    type="button"
                    class="btn btn-outline-secondary rounded-pill px-4"
                    data-bs-dismiss="modal"
                >
                    Cancel
                </button>
                <a
                    href="../php/adminlogout.php"
                    class="btn btn-danger rounded-pill px-4"
                >
                    Logout
                </a>
            </div>

        </div>
    </div>
</div>

<script src="js/scanner.js"></script>
<script>



  const btn = document.getElementById("scanBtn");

  btn.addEventListener("click", simulateScan);

  document.addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
      event.preventDefault();
      btn.click();
    }
  });

function simulateScan() {

    const fakeQR = document.getElementById("manualQR").value.trim();

    if (!fakeQR) {
        alert("Enter QR value first.");
        return;
    }

    console.log("Simulated Scan:", fakeQR);

    // This calls the SAME function used by real scanner
    onScanSuccess(fakeQR);
}






document.addEventListener("DOMContentLoaded", () => {
    fetch("php/dashboard.php")
        .then(res => res.json())
        .then(data => renderRegions(data));



            const searchInput = document.querySelector('input[type="search"]');
    searchInput.addEventListener('input', function() {
        const filter = this.value.toLowerCase().trim();
        const rows = document.querySelectorAll('#examineeTableBody tr');
        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            const text = (cells[0].textContent + cells[1].textContent + cells[2].textContent).toLowerCase();
            row.style.display = text.includes(filter) ? '' : 'none';
        });
    });
});


/* âœ… Dynamic Toggle (Event Delegation) */
document.addEventListener("click", function(e) {

    const header = e.target.closest(".venue-header");
    if (!header) return;

    const targetId = header.dataset.target;
    const schedule = document.getElementById(targetId);
    const icon = header.querySelector(".venue-toggle");

    if (!schedule) return;

    schedule.classList.toggle("show");
    icon.classList.toggle("open");
});


function renderRegions(data) {
  const container = document.getElementById("regionsContainer");
  container.innerHTML = "";

  Object.keys(data).forEach(region => {

    let regionHTML = `
      <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 region-divider">
        <div class="h-100">

          <h6 class="fw-bold text-uppercase text-muted mb-3"
              style="letter-spacing:0.12em;">
            ${region}
          </h6>

          <div class="region-table">
            <div class="region-table-header"
                 style="grid-template-columns: 2fr 1fr 1fr 1fr;">
              <span>Venue</span>
              <span>Registered</span>
              <span>Limit</span>
              <span>Available</span>
            </div>
    `;

    Object.keys(data[region]).forEach(venue => {
      const venueId = `${region}-${venue}`.replace(/\s+/g, '-');

      regionHTML += `
        <div class="venue-header d-flex justify-content-between align-items-center mb-1"
             data-target="${venueId}">
          <strong>${venue}</strong>
          <button class="venue-toggle">
            <i class="bx bx-chevron-down"></i>
          </button>
        </div>

        <div class="venue-schedule" id="${venueId}">
      `;

      data[region][venue].forEach(sched => {
        const available = sched.limit - sched.registered;

        regionHTML += `
          <div class="region-table-row"
               style="grid-template-columns: 2fr 1fr 1fr 1fr;"
               data-region="${region}"
               data-venue="${venue}"
               data-date="${sched.date}"
               onclick="selectSchedule('${region}', '${venue}', '${sched.date}', this)">
            <span>${formatDate(sched.date)}</span>
            <span class="fw-semibold">${sched.registered}</span>
            <span class="fw-semibold text-danger">${sched.limit}</span>
            <span class="fw-semibold text-success">${available}</span>
          </div>
        `;
      });

      regionHTML += `</div>`;
    });

    regionHTML += `
          </div>
        </div>
      </div>
    `;

    container.insertAdjacentHTML("beforeend", regionHTML);
  });
}


function formatDate(date) {
    return new Date(date).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
}

function selectSchedule(region, venue, date, element) {
    if (element.classList.contains('selected')) {
        // Unselect
        element.classList.remove('selected');
        window.selectedRegion = null;
        window.selectedVenue = null;
        window.selectedDate = null;
        console.log("Unselected schedule");
    } else {
        // Remove selected class from all rows
        document.querySelectorAll('.region-table-row.selected').forEach(row => {
            row.classList.remove('selected');
        });

        // Add selected class to clicked row
        element.classList.add('selected');

        // Store selected values globally
        window.selectedRegion = region;
        window.selectedVenue = venue;
        window.selectedDate = date;

        console.log(`Selected: Region=${region}, Venue=${venue}, Date=${date}`);
    }
}
</script>




</body>
</html>
