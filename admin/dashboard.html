<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="../imgs/PSI.png">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<link rel="stylesheet" href="../css/dashstyle.css">
  <link rel="stylesheet" href="../css/style.css">
	<title>Dashboard</title>
</head>


<body>

	<!-- Sidebar Section -->
    <section id="sidebar">
        <a href="#" class="brand" style="display: flex; align-items: center;">
          <img src="../imgs/PSI.png" alt="RHULogo" class="logo">
          <span class="text">PSI-ADMIN Portal</span>
        </a>
        <ul class="side-menu top">
          <li class="active">
            <a href="dashboard.html">
              <i class="bx bxs-dashboard"></i>
              <span class="text">Dashboard</span>
            </a>
          </li>

          <li>
            <a href="schedule.html">
              <i class="bx bx-calendar-check"></i>
              <span class="text">Create Schedule</span>
            </a>
          </li>

          <li>
            <a href="managesched.html">
              <i class="bx bx-edit"></i>
              <span class="text">Schedule Management</span>
            </a>
          </li>
            <li>
                <a href="examinee.html">
                    <i class="bx bx-group"></i>
                    <span class="text">Examinee Management</span>
                </a>
            </li>          
          
        </ul>
        <ul class="side-menu">
      <li>
          <a href="#" data-bs-toggle="modal" data-bs-target="#logoutModal">
            <i class="bx bxs-log-out-circle"></i>
            <span class="text">Logout</span>
          </a>
    </li>
    </ul>		
  </section>

	<section id="content">
		<nav>
      	<div class="greeting">
            <span>Admin</span>
        </div>
		</nav>


<main>

  <div class="container-fluid mt-3 mb-4">
  <div class="card border-0 shadow-sm rounded-4 p-3">
    <div class="d-flex align-items-center gap-3">
      
      <!-- PSI Logo -->
      <img src="../imgs/PSI.png"
           alt="PSI Logo"
           class="rounded-circle"
           style="width:60px; height:60px; object-fit:cover;">

      <!-- Message -->
      <div>
        <h6 class="mb-1 fw-bold text-uppercase" style="letter-spacing:0.08em;">
          Psy Systems and Innovations, OPC.
        </h6>
        <p class="mb-0 text-muted small">
          Examination Registration Dashboard — monitor venue capacity, registration limits,
          and regional availability in real time.
        </p>
      </div>

    </div>
  </div>
</div>


  <div class="container-fluid mt-4">
   <div class="row g-3 justify-content-start region-row-wrapper">

<div class="container-fluid mt-4">
  <div class="row g-3 justify-content-start region-row-wrapper" id="regionsContainer">
    <!-- JS builds everything -->
  </div>
</div>


  </div>
</div>

    <!-- TABLE SECTION -->
    <div class="container-fluid py-5">
      <div class="container py-4">

      <div class="card table-card border-0 overflow-hidden">

          <div class="px-4 py-3 border-bottom bg-white">
            <div class="d-flex flex-wrap justify-content-between align-items-center gap-3">

              <!-- Title -->
              <div class="px-4 py-3 table-card-header">
                <h6 class="fw-semibold mb-1">Registered Examinees for Manila</h6>
              </div>

              <!-- Filters -->
              <div class="d-flex align-items-center gap-2">
                <input type="search"
                      class="form-control form-control-sm"
                      placeholder="Search test permit, name, or email">

                <input type="date" class="form-control form-control-sm">
              </div>

            </div>
          </div>

          <!-- Table -->
          <div class="table-responsive">
            <table class="table align-middle mb-0 table-hover">
              <thead class="small text-uppercase text-muted">
                <tr>
                  <th>Test Permit</th>
                  <th>Email</th>
                  <th>Name</th>
                  <th>Date</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>1234-5678</td>
                  <td>juan.delacruz@email.com</td>
                  <td>Juan Dela Cruz</td>
                  <td>12 March 2026</td>
                </tr>

                <tr>
                  <td>1234-5678</td>
                  <td>maria.santos@email.com</td>
                  <td>Maria Santos</td>
                  <td>12 March 2026</td>
                </tr>

                <tr>
                  <td>1234-5679</td>
                  <td>pedro.reyes@email.com</td>
                  <td>Pedro Reyes</td>
                  <td>13 March 2026</td>
                </tr>
              </tbody>
            </table>
          </div>

        </div>

      </div>
    </div>

</main>

<div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="logoutModalLabel">Confirm Logout</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to log out?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <a href="../php/logout.php" class="btn btn-danger">Logout</a>
      </div>
    </div>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {
    fetch("php/dashboard.php")
        .then(res => res.json())
        .then(data => renderRegions(data));
});


/* ✅ Dynamic Toggle (Event Delegation) */
document.addEventListener("click", function(e) {

    const header = e.target.closest(".venue-header");
    if (!header) return;

    const targetId = header.dataset.target;
    const schedule = document.getElementById(targetId);
    const icon = header.querySelector(".venue-toggle");

    if (!schedule) return;

    schedule.classList.toggle("show");
    icon.classList.toggle("open");
});


function renderRegions(data) {

    const container = document.getElementById("regionsContainer");
    container.innerHTML = "";

    Object.keys(data).forEach(region => {

        let regionHTML = `
        <div class="col-xl-4 col-lg-4 col-md-6">
            <div class="region-card">
                <div class="region-header">
                    <span class="region-title">${region}</span>
                </div>

                <div class="region-table">
                    <div class="region-table-header"
                         style="grid-template-columns: 2fr 1fr 1fr 1fr;">
                        <span>Venue</span>
                        <span>Registered</span>
                        <span>Limit</span>
                        <span>Available</span>
                    </div>
        `;

        Object.keys(data[region]).forEach(venue => {

            const venueId = venue.replace(/\s+/g, '-');

            regionHTML += `
                <div class="venue-header d-flex justify-content-between align-items-center mb-1"
                     data-target="${venueId}">
                    <strong>${venue}</strong>
                    <button class="venue-toggle">
                        <i class="bx bx-chevron-down"></i>
                    </button>
                </div>

                <div class="venue-schedule" id="${venueId}">
            `;

            data[region][venue].forEach(sched => {

                const available = sched.limit - sched.registered;

                regionHTML += `
                    <div class="region-table-row region-row"
                         style="grid-template-columns: 2fr 1fr 1fr 1fr;">
                        <span>${formatDate(sched.date)}</span>
                        <span>${sched.registered}</span>
                        <span>${sched.limit}</span>
                        <span>${available}</span>
                    </div>
                `;
            });

            regionHTML += `</div>`;
        });

        regionHTML += `
                </div>
            </div>
        </div>
        `;

        container.innerHTML += regionHTML;
    });
}


function formatDate(date) {
    return new Date(date).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
}
</script>


</body>
</html>
