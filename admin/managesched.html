<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

     <title>Schedule Management</title>
    <link rel="icon" href="../imgs/PSI.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" defer></script>
    <link href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/dashstyle.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
	<script src="js/managesched.js" defer></script>
</head>
<style>
.modal-content {
  background: #ffffff;
}


#confirmDeleteBtn:hover {
  background-color: #b91c1c;
}

/* Alert refinement */
.alert-danger {
  background-color: rgba(220, 38, 38, 0.08);
  border-color: rgba(220, 38, 38, 0.25);
}

.form-control-lg,
.form-select {
  border-radius: 14px;
  border: 1px solid #e5e7eb;
  transition: all 0.2s ease;
}

.form-control-lg:focus,
.form-select:focus {
  border-color: #0f172a;
  box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.12);
}

/* Modal background feel */
.modal-content {
  background: #ffffff;
}

/* Header spacing refinement */
.modal-header {
  padding-bottom: 0;
}

/* Save button hover */
#saveScheduleBtn:hover {
  background: #020617;
}

.custom-pagination {
  gap: 6px;
}

.custom-pagination .page-item {
  margin: 0;
}

.custom-pagination .page-link {
  border: none;
  background: transparent;
  color: #374151;
  font-weight: 500;
  padding: 8px 14px;
  border-radius: 10px;
  transition: all 0.2s ease;
}

.custom-pagination .page-link:hover {
  background-color: #f3f4f6;
  color: #111827;
  border: none;
}

.custom-pagination .page-item.active .page-link {
    background-color: #0f172a; 
    color: #ffffff;
    border: none;
}

.custom-pagination .page-item.disabled .page-link {
    color: #9ca3af;
    pointer-events: none;
    border: none;
}

.custom-pagination .page-link {
    border: none !important;
    background: transparent;
    color: #374151;
    font-weight: 500;
    padding: 8px 14px;
    border-radius: 10px;
    transition: all 0.2s ease;
}

.custom-pagination .page-link:focus {
    outline: none !important;
    box-shadow: none !important;
}

.custom-pagination .page-link:hover {
    background-color: #f3f4f6;
    color: #111827;
    border: none;
}

.schedule-table tbody tr {
transition: background-color 0.2s ease;
}

.schedule-table tbody tr:hover {
background-color: #f9fafb;
}

.schedule-table td {
padding-top: 1rem;
padding-bottom: 1rem;
}

.page-header {
    padding: 15px 24px;
    border-bottom: 3px solid #acacac;
    max-width: 60%;
}

.page-title {
  font-weight: 800;
  font-size: 2rem;
  color: #000;
  margin-bottom: 0.75rem;
}

.page-description {
  font-size: 1rem;
  line-height: 1.7;
  color: #4b5563;
  margin: 0;
}
.btn-close:focus,
.no-focus:focus {
    outline: none;
    box-shadow: none;
}

</style>
<body>

    <!-- Sidebar Section -->
    <section id="sidebar">
        <a href="#" class="brand d-flex align-items-center">
            <img src="../imgs/PSI.png" alt="RHULogo" class="logo">
            <span class="text">PSI-ADMIN Portal</span>
        </a>

        <ul class="side-menu top">
            <li>
                <a href="dashboard.html">
                    <i class="bx bxs-dashboard"></i>
                    <span class="text">Dashboard</span>
                </a>
            </li>

            <li>
                <a href="schedule.html">
                    <i class="bx bx-calendar-check"></i>
                    <span class="text">Create Schedule</span>
                </a>
            </li>

            <li class="active">
                <a href="managesched.html">
                    <i class="bx bx-edit"></i>
                    <span class="text">Schedule Management </span>
                </a>
            </li>

            <li>
                <a href="masterlist.html">
                    <i class="bx bx-list-ul"></i>
                    <span class="text">Examinee Masterlist</span>
                </a>
            </li>

                <li>
                    <a href="examinee.html">
                        <i class="bx bx-group"></i>
                        <span class="text">Examinee Management</span>
                    </a>
                </li>  
                <li>
                    <a href="examhistory.html">
                        <i class="bx bx-history"></i>
                        <span class="text">Exam History</span>
                    </a>
                </li> 

                <li>
                    <a href="activity_log.html">
                        <i class="bx bx-notepad"></i>
                        <span class="text">Activity Log</span>
                    </a>
                </li>
                <li>
                    <a href="faqsmanagement.html">
                       <i class="bx bx-task"></i>
                        <span class="text">FAQs Management </span>
                    </a>
                </li>
        </ul>
    </section>

    <!-- Content Section -->
    <section id="content">
      <nav class="d-flex justify-content-end align-items-center px-4">
        
        <div class="dropdown">
          <!-- Admin Icon -->
          <a href="#"
            class="d-flex align-items-center text-decoration-none"
            id="adminDropdown"
            data-bs-toggle="dropdown"
            aria-expanded="false">
            
            <i class="bx bxs-user-circle fs-2 text-primary"></i>
            <i class="bx bx-chevron-down ms-1 text-muted"></i>
          </a>

          <!-- Dropdown Menu -->
          <ul class="dropdown-menu dropdown-menu-end shadow-sm border-0 mt-2">
            <li class="dropdown-header small text-muted">
              Administrator
            </li>

            <li><hr class="dropdown-divider"></li>

            <li>
              <a class="dropdown-item d-flex align-items-center text-danger"
                href="#"
                data-bs-toggle="modal"
                data-bs-target="#logoutModal">
                <i class="bx bxs-log-out-circle me-2"></i>
                Logout
              </a>
            </li>
          </ul>
        </div>

      </nav>

		<main class="p-4">

			<!-- Alert Container -->
			<div id="alertContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 9999;"></div>

			<!-- Page Header -->
			<div class="page-header mb-4">
				<h2 class="page-title">
				Examination Schedule
				</h2>

				<p class="page-description">
         This module manages and maintains official examination schedules, including region, venue details, examination date, capacity limits, examination fees, and availability status.
         All published schedules are accessible to applicants and designated examination personnel.
				</p>
			</div>


			<!-- Schedule Container -->
			<div class="card border-0 rounded-4">
				<div class="card-body p-4">

					<!-- Controls -->
					<div class="row g-3 align-items-center mb-4">
						<div class="col-md-3">
							<input
								type="text"
								class="form-control"
								id="searchInput"
								placeholder="Search by venue or date..."
							>
						</div>

						<div class="col-md-2">
							<select class="form-select" id="regionFilter">
								<option value="">Filter by Region</option>
								<option value="Luzon">Luzon</option>
								<option value="Visayas">Visayas</option>
								<option value="Mindanao">Mindanao</option>
							</select>
						</div>

						<div class="col-md-2">
							<select class="form-select" id="statusFilter">
								<option value="">Filter by Status</option>
								<option value="Incoming">Incoming</option>
								<option value="Closed">Closed</option>
								<option value="Completed">Completed</option>
							</select>
						</div>

						<div class="col-md-2">
							<select class="form-select" id="sortFilter">
								<option value="">Sort by Date</option>
								<option value="newest">Newest First</option>
								<option value="oldest">Oldest First</option>
							</select>
						</div>

						<div class="col-md-2 text-md-end">
							<span class="text-muted small">
								Total: <strong id="totalCount">0</strong>
							</span>
						</div>
					</div>

					<!-- Modern Table -->
					<div class="table-responsive">
						<table class="table table-borderless align-middle mb-0 schedule-table">
							<thead>
								<tr class="text-uppercase small text-muted border-bottom">
									<th>#</th>
									<th>Region</th>
									<th>Venue</th>
									<th>Date</th>
									<th>Capacity</th>
									<th>Exam Fee</th>
									<th>Status</th>
									<th class="text-end">Actions</th>
								</tr>
							</thead>

							<tbody id="scheduleTableBody">
								<!-- Schedules will be loaded dynamically -->
								<tr>
									<td colspan="8" class="text-center py-5">
										<div class="spinner-border text-primary" role="status">
											<span class="visually-hidden">Loading...</span>
										</div>
										<p class="text-muted mt-2">Loading schedules...</p>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
                       <div id="pagination" class="d-flex justify-content-center"></div>
				</div>
			</div>

		</main>


    </section>

    <!-- Logout Modal -->
<div
    class="modal fade"
    id="logoutModal"
    tabindex="-1"
    aria-labelledby="logoutModalLabel"
    aria-hidden="true"
>
    <div class="modal-dialog modal-md modal-dialog-centered">
        <div class="modal-content border-0 rounded-4 shadow">

            <!-- Modal Header -->
            <div class="modal-header bg-light border-0 rounded-top-4 px-4 py-3">
                <h5 class="modal-title fw-bold mb-0" id="logoutModalLabel">
                    Confirm Logout
                </h5>
                <button
                    type="button"
                    class="btn-close no-focus"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                ></button>
            </div>

            <!-- Divider -->
            <div class="px-4">
                <hr class="my-0">
            </div>

            <!-- Modal Body -->
            <div class="modal-body px-4 py-4 text-center">
                <i class="bx bx-log-out-circle fs-1 text-muted mb-3"></i>
                <p class="mb-0 text-muted">
                    Are you sure you want to log out of your account?
                </p>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer border-0 px-4 pb-4 pt-2 justify-content-center">
                <button
                    type="button"
                    class="btn btn-outline-secondary rounded-pill px-4"
                    data-bs-dismiss="modal"
                >
                    Cancel
                </button>
                <a
                    href="../php/adminlogout.php"
                    class="btn btn-danger rounded-pill px-4"
                >
                    Logout
                </a>
            </div>

        </div>
    </div>
</div>

<!-- Edit Schedule Modal -->
<div class="modal fade" id="editScheduleModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content border-0 rounded-4 shadow-lg">

      <!-- Header -->
      <div class="modal-header border-0 px-4 py-4">
        <div>
          <h5 class="modal-title fw-bold mb-1">
            <i class="bx bx-edit-alt me-2 text-primary"></i>Edit Examination Schedule
          </h5>
          <small class="text-muted">
            Update venue, date, capacity, fee, and availability
          </small>
        </div>
        <button type="button" class="btn-close no-focus" data-bs-dismiss="modal"></button>
      </div>

      <!-- Body -->
      <div class="modal-body px-4 pb-4">
        <form id="editScheduleForm">
          <input type="hidden" id="editScheduleId" name="schedule_id">

          <!-- Section Card -->
          <div class="p-4 rounded-4 bg-light border">

            <div class="row g-4">

              <!-- Region -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">Region</label>
                <select class="form-select form-control-lg" id="editRegion" name="region" required>
                  <option value="">Select Region</option>
                  <option value="Luzon">Luzon</option>
                  <option value="Visayas">Visayas</option>
                  <option value="Mindanao">Mindanao</option>
                </select>
              </div>

              <!-- Venue -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">Venue Name</label>
                <input type="text"
                       class="form-control form-control-lg"
                       id="editVenue"
                       name="venue_name"
                       placeholder="Enter venue"
                       required>
              </div>

              <!-- Date -->
              <div class="col-md-12">
                <label class="form-label fw-semibold">Examination Date</label>
                <input type="date"
                       class="form-control form-control-lg"
                       placeholder = "Select examination date"
                       id="editDate"
                       name="date"
                       required>
              </div>

              <!-- Capacity -->
              <div class="col-md-4">
                <label class="form-label fw-semibold">Capacity</label>
                <input type="number"
                       class="form-control form-control-lg"
                       id="editCapacity"
                       name="capacity"
                       min="1"
                       required>
              </div>

              <!-- Exam Fee -->
              <div class="col-md-4">
                <label class="form-label fw-semibold">Exam Fee (â‚±)</label>
                <input type="number"
                       class="form-control form-control-lg"
                       id="editPrice"
                       name="price"
                       min="0"
                       step="0.01"
                       required>
              </div>

              <!-- Status -->
              <div class="col-md-4">
                <label class="form-label fw-semibold">Status</label>
                <select class="form-select form-control-lg" id="editStatus" name="status" required>
                  <option value="Incoming">Incoming</option>
                  <option value="Closed">Closed</option>
                  <option value="Completed">Completed</option>
                </select>
              </div>

            </div>
          </div>
        </form>
      </div>

      <!-- Footer -->
      <div class="modal-footer border-0 px-4 pb-4 pt-0 d-flex justify-content-between">
        <button type="button"
                class="btn btn-outline-secondary rounded-pill px-4"
                data-bs-dismiss="modal">
          Cancel
        </button>

        <button type="button"
                id="saveScheduleBtn"
                onclick="saveScheduleChanges()"
                class="btn rounded-pill px-5 fw-semibold text-white"
                style="background:#0f172a;">
          Save Changes
        </button>
      </div>

    </div>
  </div>
</div>


<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4">

      <!-- Modal Header -->
      <div class="modal-header border-0 justify-content-center pb-0">
        <h5 class="modal-title fw-semibold">
          Delete Schedule
        </h5>
        <button type="button" class="btn-close position-absolute end-0 me-3" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body px-4 py-4 text-center">
        <input type="hidden" id="deleteScheduleId">
        
        <i class="bx bx-trash fs-1 text-danger mb-3"></i>
        
        <p class="mb-2 text-muted">
          Are you sure you want to delete this schedule?
        </p>
        
        <h6 class="fw-bold mb-3" id="deleteVenueName">
          <!-- Venue Name will be populated -->
        </h6>
        
        <div class="alert alert-danger d-flex align-items-center justify-content-center gap-2 py-2 mb-0">
          <i class="bx bx-error-circle"></i>
          <small>This action cannot be undone.</small>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer border-0 px-4 pb-4 pt-2 justify-content-center gap-2">
        <button type="button" class="btn btn-outline-secondary rounded-pill px-4" data-bs-dismiss="modal">
          Cancel
        </button>
        <button type="button" id="confirmDeleteBtn" onclick="deleteSchedule()" class="btn btn-danger rounded-pill px-4">
          <i class="bx bx-trash me-1"></i> Delete
        </button>
      </div>

    </div>
  </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4">

      <!-- Modal Body -->
      <div class="modal-body px-4 py-5 text-center">
        <div class="mb-3">
          <i class="bx bx-check-circle fs-1 text-success"></i>
        </div>
        
        <h5 class="fw-bold mb-2">Update Successful!</h5>
        
        <p class="text-muted mb-4" id="successMessage">
          Schedule status has been updated successfully.
        </p>
        
        <button type="button" class="btn btn-success rounded-pill px-5" data-bs-dismiss="modal">
          Done
        </button>
      </div>

    </div>
  </div>
</div>

<!-- Error Modal -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4">

      <!-- Modal Body -->
      <div class="modal-body px-4 py-5 text-center">
        <div class="mb-3">
          <i class="bx bx-error-circle fs-1 text-danger"></i>
        </div>
        
        <h5 class="fw-bold mb-2">Update Failed</h5>
        
        <p class="text-muted mb-4" id="errorMessage">
          There was an error updating the schedule. Please try again.
        </p>
        
        <button type="button" class="btn btn-outline-secondary rounded-pill px-5" data-bs-dismiss="modal">
          Close
        </button>
      </div>

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
// Initialize flatpickr for Edit Schedule modal
document.addEventListener('DOMContentLoaded', function() {
    flatpickr("#editDate", {
        dateFormat: "Y-m-d",
        minDate: "today",
        altInput: true,
        altFormat: "F j, Y",
        allowInput: true
    });
});
</script>

<script>
// Check admin session on page load
(function() {
    fetch('php/check_session.php', {
        method: 'GET',
        credentials: 'same-origin'
    })
    .then(response => response.json())
    .then(data => {
        if (!data.authenticated) {
            // Redirect to admin login if not authenticated
            window.location.href = '../adminlogin.html';
        }
    })
    .catch(error => {
        console.error('Session check failed:', error);
        window.location.href = '../adminlogin.html';
    });
})();
</script>

</body>
</html>
