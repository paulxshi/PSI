<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="../imgs/PSI.png">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css" rel="stylesheet">
	<link rel="stylesheet" href="../css/dashstyle.css">
  <link rel="stylesheet" href="../css/permitpdf.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

	<title>Test Permit</title>
</head>
  
<body>

	<!-- Sidebar Section -->
		<section id="sidebar">
		<a href="#" class="brand" style="display: flex; align-items: center;">
			<img src="../imgs/PSI.png" alt="PSILogo" class="logo">
			<span class="text">PSI-PMMA Portal</span>
		</a>
		<ul class="side-menu top">
			<li>
				<a href="dashboard.html">
					<i class="bx bxs-dashboard"></i>
					<span class="text">Dashboard</span>
				</a>
			</li>

      <li class="active">
        <a href="accountsettings.html">
          <i class="bx bx-cog ms-1"></i>
          <span class="text">Account Settings</span>
        </a>
      </li>
		</ul>

		<ul class="side-menu">
<li>
  <a href="#" data-bs-toggle="modal" data-bs-target="#logoutModal">
    <i class="bx bxs-log-out-circle"></i>
    <span class="text">Logout</span>
  </a>
</li>
</ul>
		
	</section>

	<section id="content">
		<nav>
      			<div class="greeting">
                
            </div>
		</nav>

<!-- MAIN CONTENT -->
<main class="container py-3">

      <div class="mb-4">
        <a href="dashboard.html" class="back-btn" aria-label="Go back">
          <span class="back-btn__track"></span>
          <span class="back-btn__arrow">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none"
              viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
            </svg>
          </span>
          <span class="back-btn__label">Go Back</span>
          <span class="back-btn__shine"></span>
        </a>
      </div>

      <div id="permitPDF" class="bg-white p-4 shadow-sm">
        <div class="permit-header">

          <!-- QR Code (left) -->
          <div class="qr-col">
            <div class="qr-code-square-container">
              <img id="qrCode" src="../imgs/QR.png" alt="QR Code">
              <img src="../imgs/PSI.png" alt="PSI Logo" class="qr-logo">
            </div>
          </div>

          <!-- Center: Logo + Title -->
          <div class="center-col">
            <img src="../imgs/PSI.png" class="psi-logo" alt="PSI Logo">
            <h5>PSY Systems and Innovations, OPC</h5>
          </div>

          <!-- Examinee Photo (right) -->
          <div class="photo-col">
            <div class="photo-box">
              <img src="../imgs/avatar.png" alt="Examinee Photo">
            </div>
          </div>

        </div><!-- /permit-header -->

        <hr style="margin: 8px 0; border-color:#aaa;">

        <!-- Exam Type -->
        <div class="text-center mb-2">
          <span class="text-muted text-uppercase fw-semibold" style="font-size: 12px; letter-spacing: 1px;">
            Philippine Marine Merchant Academy<br>
            PSYCHOLOGICAL EVALUATION TEST PERMIT
          </span>
        </div>

        <!-- RED NOTE -->
        <div class="permit-note">
          Please bring this test permit on your examination day.
        </div>
        
        <div class="permit-content">
          
          <!-- Section Headers -->
          <div class="content-headers mb-2">
            <div class="row g-0">
              <div class="col-6">
                <h6 class="section-title">Personal Information</h6>
              </div>
              <div class="col-6">
                <h6 class="section-title">Schedule of Examination</h6>
              </div>
            </div>
          </div>

          <!-- Row 1: Personal Info + Schedule -->
          <div class="row g-0 mb-2">
            <div class="col-6 pe-3">
              <div class="d-flex gap-2">
                <div>
                  <div class="field-label">Test Permit</div>
                  <div class="field-value fw-semibold" id="testPermit">050-2018</div>
                </div>
                <div>
                  <div class="field-label">Name of Examinee</div>
                  <div class="field-value fw-semibold" id="fullName">User</div>
                </div>
                <div>
                  <div class="field-label">Date of Birth</div>
                  <div class="field-value fw-semibold" id="dob">02/11/2026</div>
                </div>
              </div>
            </div>
            <div class="col-6">
              <div class="d-flex gap-3">
                <div>
                  <div class="field-label">Date of Examination</div>
                  <div class="field-value fw-semibold" id="dateOfTest">05/27/2025</div>
                </div>
                <div>
                  <div class="field-label">Venue</div>
                  <div class="field-value fw-semibold" id="venue">Manila</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Section Header: Contact + Payment -->
          <div class="content-headers mb-2 mt-3">
            <div class="row g-0">
              <div class="col-6">
                <h6 class="section-title">Contact Details</h6>
              </div>
              <div class="col-6">
                <h6 class="section-title">Payment Details</h6>
              </div>
            </div>
          </div>

          <!-- Row 2: Contact + Payment -->
          <div class="row g-0">
            <div class="col-6 pe-3">
              <div class="d-flex gap-2">
                <div>
                  <div class="field-label">Contact Number</div>
                  <div class="field-value fw-semibold" id="contact">09123456789</div>
                </div>
                <div>
                  <div class="field-label">Email Address</div>
                  <div class="field-value fw-semibold" id="email">example@gmail.com</div>
                </div>
              </div>
            </div>
            
            <div class="col-6">
              <div class="d-flex gap-2">
                <div>
                  <div class="field-label">Transaction No.</div>
                  <div class="field-value fw-semibold" id="transactionNo">123456789</div>
                </div>
                <div>
                  <div class="field-label">Payment Date</div>
                  <div class="field-value fw-semibold" id="paymentDate">02/11/2026</div>
                </div>
                <div>
                  <div class="field-label">Payment Method</div>
                  <div class="field-value fw-semibold" id="paymentMethod"></div>
                </div>
              </div>
            </div>
          </div>

        </div>

        <!-- ─────────────────────────────────
             GUIDELINES + SIGNATURE
        ───────────────────────────────── -->
        <div class="d-flex gap-4 mt-3 align-items-start">

          <!-- Guidelines -->
          <div class="guidelines-section flex-grow-1">
            <h6>Guidelines</h6>
            <ol>
              <li><strong>Examination fees are non-refundable under any circumstances.</strong></li>
              <li>Wear white shirt, Denim pants, and rubber shoes on examination day.</li>
              <li>Bring a valid or Student ID for verification purposes.</li>
              <li>Bring 2 pencils, eraser, sharpener.</li>
              <li>Bring snacks (to be consumed outside the testing room).</li>
              <li>Mobile phones, smartwatches, and other electronic devices are strictly prohibited within the testing room.</li>
            </ol>
          </div>

          <!-- Signature block -->
          <div class="signature-block flex-shrink-0">
            <div class="sig-line"></div>
            <div class="sig-label">Signature of verifier</div>
            <div class="sig-sub">(to be filled by assigned psi officials)</div>
          </div>

        </div>

        </div>

      </div>

      <div class="d-flex justify-content-center mt-4">
        <button id="generatePDF" class="btn btn-danger px-4 py-2">
          <i class="bx bx-download me-2"></i>
          Generate PDF
        </button>
      </div>

</main>

      <!-- Logout Confirmation Modal -->
      <div
        class="modal fade"
        id="logoutModal"
        tabindex="-1"
        aria-labelledby="logoutModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered logout-modal">
          <div class="modal-content border-0 rounded-4 shadow">

            <!-- Header -->
            <div class="modal-header bg-light border-0 rounded-top-4 px-4 py-3">
              <h5 class="modal-title fw-bold mb-0" id="logoutModalLabel">
                Confirm Logout
              </h5>
              <button
                type="button"
                class="btn-close no-focus"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>

            <!-- Divider -->
            <div class="px-4">
              <hr class="my-0">
            </div>

            <!-- Body -->
            <div class="modal-body px-4 py-4 text-center">
              <i class="bx bx-log-out-circle fs-1 text-muted mb-3"></i>
              <p class="mb-0 text-muted">
                Are you sure you want to log out of your account?
              </p>
            </div>

            <!-- Footer -->
            <div class="modal-footer border-0 px-4 pb-4 pt-2 justify-content-center">
              <button
                type="button"
                class="btn btn-outline-secondary rounded-pill px-4"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <a
                href="../php/logout.php"
                class="btn btn-danger rounded-pill px-4"
              >
                Logout
              </a>
            </div>

          </div>
        </div>
      </div>


<!-- SCRIPTS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="js/testPermit.js"></script>

<script>
    document.getElementById('generatePDF').addEventListener('click', async () => {
      const permit = document.getElementById('permitPDF');
      const btn = document.getElementById('generatePDF');

      btn.disabled = true;
      btn.innerHTML = '<i class="bx bx-loader-alt bx-spin me-2"></i>Generating...';

      document.body.classList.add('print-mode');

      await html2pdf().set({
        margin: 0,
        filename: 'PMMA_Test_Permit.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true, scrollY: 0 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' },
        pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
      }).from(permit).save();

      document.body.classList.remove('print-mode');

      btn.disabled = false;
      btn.innerHTML = '<i class="bx bx-download me-2"></i>Generate PDF';
    });
  </script>

  <script>
    // Check user session on page load
    (function() {
      fetch('php/check_session.php', { method: 'GET', credentials: 'same-origin' })
        .then(response => response.json())
        .then(data => {
          if (!data.authenticated) {
            window.location.href = '../auth/login.html';
          }
        })
        .catch(error => {
          console.error('Session check failed:', error);
          window.location.href = '../auth/login.html';
        });
    })();
  </script>

</body>
</html>

