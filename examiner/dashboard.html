<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="../imgs/PSI.png">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css" rel="stylesheet">
	<link rel="stylesheet" href="../css/dashstyle.css">
  <link rel="stylesheet" href="css/dashboard.css">
	<title>Dashboard</title>
</head>


<body>

	<!-- Sidebar Section -->
	<section id="sidebar">
		<a href="#" class="brand" style="display: flex; align-items: center;">
			<img src="../imgs/PSI.png" alt="PSILogo" class="logo">
			<span class="text">PSI-PMMA Portal</span>
		</a>
		<ul class="side-menu top">
			<li class="active">
				<a href="dashboard.html">
					<i class="bx bxs-dashboard"></i>
					<span class="text">Dashboard</span>
				</a>
			</li>

      <li>
        <a href="accountsettings.html">
          <i class="bx bx-cog ms-1"></i>
          <span class="text">Account Settings</span>
        </a>
      </li>
		</ul>

		<ul class="side-menu">
      <li>
        <a href="#" data-bs-toggle="modal" data-bs-target="#logoutModal">
          <i class="bx bxs-log-out-circle"></i>
          <span class="text">Logout</span>
        </a>
      </li>
    </ul>
		
	</section>

	<section id="content">

    <main class="container-fluid p-4">

      <!-- EXAM INFO HEADER -->
    <div class="row mb-4">
        <div class="col-12">
          <div class="d-flex justify-content-between text-center exam-info">

            <div class="flex-fill">
              <small class="d-inline-block bg-success bg-opacity-10 text-success 
                          px-3 py-1 rounded-pill text-uppercase fw-semibold mb-2">
                Date of Registration
              </small>
              <div class="fw-bold" id="registration-date">
                <!-- JS will populate -->
              </div>
            </div>

            <div class="flex-fill">
              <small class="d-inline-block bg-success bg-opacity-10 text-success 
                          px-3 py-1 rounded-pill text-uppercase fw-semibold mb-2">
                Date of Examination
              </small>
              <div class="fw-bold" id="examination-date">
                <!-- JS will populate -->
              </div>
            </div>

              <div class="flex-fill">
              <small class="d-inline-block bg-success bg-opacity-10 text-success 
                          px-3 py-1 rounded-pill text-uppercase fw-semibold mb-2">
                Examination Venue
              </small>
              <div class="fw-bold" id="examination-venue">
                <!-- JS will populate -->
              </div>
          </div>
          </div>
      </div>

    </div>

      <!-- USER INFO CONTAINER -->
      <div class="container">
        <div class="row g-4">
            <!--USER CARD -->

            <div class="col-12 col-lg-7">
                <div id="userCard" class="content-box">
                  <!-- USER INFO -->
                </div>
            </div>

            <div class="col-12 col-lg-4">
              <div class="profile-card">

                <!-- ── background graphics ── -->
                <div class="card-bg-graphics">
                  <div class="orb-tr"></div>
                  <div class="orb-bl"></div>
                  <div class="grid-lines"></div>
                  <div class="diag-rule"></div>
                </div>

                <!-- corner accents -->
                <div class="corner-tl"></div>
                <div class="corner-tr"></div>
                <div class="corner-bl"></div>
                <div class="corner-br"></div>
                <div class="footer-rule"></div>

                <!-- ── all original content ── -->
                <div class="card-content">

                  <!-- portal badge (new) -->
                  <div class="portal-badge">
                    <div class="badge-dot"></div>
                    <span class="badge-label">Student Portal</span>
                  </div>

                  <!-- ORIGINAL -->
                  <h5 class="profile-title fw-bold text-primary">User Profile</h5>

                  <!-- gold divider (new) -->
                  <div class="gold-divider">
                    <div class="gold-divider-line"></div>
                    <div class="gold-divider-diamond"></div>
                    <div class="gold-divider-line"></div>
                  </div>

                  <!-- ORIGINAL -->
                  <p class="profile-subtitle">
                    Uploading a photo is required to access your Test Permit.
                    You can upload your photo in the <strong>Account Settings </strong>section.
                  </p>

                  <!-- ORIGINAL: Image Preview Box wrapper -->
                  <div style="margin-top: 20px; display:flex; flex-direction:column; align-items:center;">

                    <div class="spinning-ring-wrap">

                      <!-- ORIGINAL id="imagePreviewContainer" -->
                      <div id="imagePreviewContainer" class="image-preview-container">
                        <!-- ORIGINAL id="imagePreview" -->
                        <img id="imagePreview" src="../imgs/avatar.png" alt="Profile Preview" class="img-fluid" style="display: none;" />
                        <!-- ORIGINAL id="uploadPlaceholder" -->
                        <div id="uploadPlaceholder" class="upload-placeholder">
                          <i class="bx bx-image" style="font-size: 48px;"></i>
                          <p class="mt-2">No photo uploaded</p>
                        </div>
                      </div>

                    </div>

                    <span class="photo-sublabel">Official Photo</span>
                  </div>

                  <p class="profile-text" id="imageText" style="margin-top: 25px;"> </p>

                  <a href="testpermit.html" id="permitLink">
                    <button id="btnViewPermit" class="btn-view-permit" disabled>
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink:0;">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                      </svg>
                      View Test Permit
                    </button>
                  </a>

                  <div class="lock-hint" id="lockHint">
                    <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="11" width="18" height="11" rx="2"/>
                      <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    Locked until photo is uploaded
                  </div>

                  <a href="accountsettings.html" class="settings-link">
                    <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="3"/>
                      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    Account Settings
                  </a>

                </div>
              </div>
            </div>
          
            <div class="row g-4">
                <div class="col-12 col-lg-13">
                  <div id="faq" class="content-box">
                      <h4 class="fw-semibold mb-1">Frequently asked questions</h4>
                      <p class="text-muted mb-4" style="font-size: 0.9rem;">
                        These are the most common questions about the examination process.
                      </p>

                    <div class="faq-ui" id="faqContainer">
                      <!-- FAQs will be loaded here dynamically -->
                    </div>
                  </div>
              </div>
          </div>

     </div>
  </div>

</main>

<div
  class="modal fade"
  id="logoutModal"
  tabindex="-1"
  aria-labelledby="logoutModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered logout-modal">
    <div class="modal-content border-0 rounded-4 shadow">

      <!-- Header -->
      <div class="modal-header bg-light border-0 rounded-top-4 px-4 py-3">
        <h5 class="modal-title fw-bold mb-0" id="logoutModalLabel">
          Confirm Logout
        </h5>
        <button
          type="button"
          class="btn-close no-focus"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>

      <!-- Divider -->
      <div class="px-4">
        <hr class="my-0">
      </div>

      <!-- Body -->
      <div class="modal-body px-4 py-4 text-center">
        <i class="bx bx-log-out-circle fs-1 text-muted mb-3"></i>
        <p class="mb-0 text-muted">
          Are you sure you want to log out of your account?
        </p>
      </div>

      <!-- Footer -->
      <div class="modal-footer border-0 px-4 pb-4 pt-2 justify-content-center">
        <button
          type="button"
          class="btn btn-outline-secondary rounded-pill px-4"
          data-bs-dismiss="modal"
        >
          Cancel
        </button>
        <a
          href="../php/logout.php"
          class="btn btn-danger rounded-pill px-4"
        >
          Logout
        </a>
      </div>

    </div>
  </div>
</div>

<script>
  const btn      = document.getElementById('btnViewPermit');
  const link     = document.getElementById('permitLink');
  const lockHint = document.getElementById('lockHint');

  function syncLink() {
    const isDisabled = btn.disabled;
    link.style.pointerEvents = isDisabled ? 'none' : 'auto';
    lockHint.style.display   = isDisabled ? 'flex'  : 'none';
  }

  const observer = new MutationObserver(syncLink);
  observer.observe(btn, { attributes: true, attributeFilter: ['disabled'] });
  syncLink();
</script>

<script src="js/get_user.js"></script>
<script src="js/get_faq.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Check user session on page load
(function() {
    fetch('php/check_session.php', {
        method: 'GET',
        credentials: 'same-origin'
    })
    .then(response => response.json())
    .then(data => {
        if (!data.authenticated) {
            // Redirect to login if not authenticated
            window.location.href = '../login.html';
        }
    })
    .catch(error => {
        console.error('Session check failed:', error);
        window.location.href = '../login.html';
    });
})();
</script>

</body>
</html>
